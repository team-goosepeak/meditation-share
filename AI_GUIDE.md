# AI 가이더 기능 가이드

## 개요

Meditation Share는 ChatGPT를 활용한 AI 가이더 기능을 제공합니다. 사용자가 간략하게 작성한 묵상 메모를 피드에 공유할 수 있는 완성도 높은 글로 자동 변환해줍니다.

## 기능 구조

### 1. API Route (`/app/api/ai/refine-meditation/route.ts`)

**역할**: OpenAI API를 통해 사용자의 메모를 다듬어진 묵상 글로 변환

**입력 파라미터**:
```typescript
{
  notes: string,           // 사용자가 입력한 간략한 메모
  scriptures?: Scripture[], // 관련 성경 구절 (선택)
  previousVersion?: string  // 이전에 생성된 버전 (재검수 시)
}
```

**출력**:
```typescript
{
  refinedText: string,  // AI가 다듬은 묵상 글
  usage: object        // OpenAI API 사용량 정보
}
```

### 2. AI 프롬프트 설계

**System Prompt (AI 역할 정의)**:
- 기독교 신앙 생활을 돕는 묵상 작성 도우미
- 사용자의 핵심 메시지와 의도 유지
- 성경적 표현과 기독교 용어 적절히 사용
- 개인적 깨달음과 적용점 강조
- 진정성 있는 톤 유지
- 200-500자 적절한 길이로 조절
- 사용자의 원래 톤과 스타일 유지

**User Prompt 구성**:
1. 기본 메모 내용
2. 관련 성경 구절 (있을 경우)
3. 이전 버전 참고 (재검수 시)

### 3. UI/UX 흐름

**작성 모드 선택**:
1. **직접 쓰기**: 전통적인 방식으로 직접 작성
2. **AI 가이더**: 간략한 메모를 AI가 다듬어줌

**AI 가이더 사용 흐름**:
1. 간략한 메모 입력
2. "AI 검수" 버튼 클릭
3. AI가 다듬은 글 확인
4. 필요시 직접 수정
5. 추가 검수 가능 (다시 검수하기)
6. 최종 제출

## 설정 방법

### 1. OpenAI API 키 발급

1. [OpenAI Platform](https://platform.openai.com/)에 가입
2. API Keys 메뉴에서 새 키 생성
3. 생성된 키를 안전하게 보관

### 2. 환경 변수 설정

`.env.local` 파일에 OpenAI API 키 추가:

```bash
OPENAI_API_KEY=sk-proj-...your-key-here...
```

**주의사항**:
- `.env.local` 파일은 절대 git에 커밋하지 마세요
- `.gitignore`에 이미 포함되어 있습니다
- 프로덕션 환경에서는 Vercel 등의 환경 변수 설정 사용

### 3. 패키지 설치

```bash
npm install
```

이미 `package.json`에 `openai` 패키지가 추가되어 있습니다.

## 사용 예시

### 입력 예시 (사용자 메모):
```
- 사랑은 행동이다
- 말만 하는게 아니라 실천해야 함
- 이번주에 가족에게 더 친절하게 대하기
- 주님의 사랑을 본받자
```

### 출력 예시 (AI가 다듬은 글):
```
오늘 설교를 통해 사랑의 본질에 대해 다시 생각하게 되었습니다. 
사랑은 단순히 말이나 감정이 아니라 구체적인 행동으로 드러나야 한다는 것을 깨달았습니다.

요한일서 3:18의 "자녀들아 우리가 말과 혀로만 사랑하지 말고 
행함과 진실함으로 하자"는 말씀이 마음에 와닿습니다.

이번 주에는 가족들에게 더 친절하게 대하며, 주님께서 우리를 
사랑하신 것처럼 실천하는 삶을 살아가고자 합니다.
```

## API 사용량 및 비용

### 모델: gpt-4o-mini
- 입력: ~$0.15 / 1M tokens
- 출력: ~$0.60 / 1M tokens

### 예상 비용 (묵상 글 1회 생성):
- 입력 토큰: ~300 tokens
- 출력 토큰: ~500 tokens
- 비용: ~$0.0003 (약 0.4원)

매우 저렴하지만, 남용 방지를 위해 적절한 rate limiting 고려 필요.

## 보안 고려사항

1. **API 키 보안**:
   - 서버 사이드에서만 API 키 사용
   - 클라이언트에 절대 노출하지 않음
   - Next.js API Routes를 통한 프록시 방식

2. **입력 검증**:
   - 빈 메모 입력 방지
   - 과도하게 긴 입력 제한 (필요시)
   - Rate limiting 적용 (필요시)

3. **오류 처리**:
   - API 키 오류 (401)
   - Rate limit 초과 (429)
   - 일반 오류 (500)
   - 사용자 친화적 오류 메시지 제공

## 확장 가능성

### 향후 개선 사항:
1. **다양한 스타일 선택**: 격식체, 구어체, 시적 표현 등
2. **길이 조절**: 짧게, 보통, 길게
3. **톤 조절**: 경건한, 활발한, 성찰적 등
4. **다국어 지원**: 영어, 중국어 등
5. **버전 히스토리**: 이전 버전들 저장 및 비교
6. **AI 제안**: 성경 구절 추천, 태그 제안 등

## 문제 해결

### API 키 오류
```
Error: OpenAI API 키가 유효하지 않습니다.
```
→ `.env.local` 파일의 API 키 확인

### Rate Limit 오류
```
Error: API 요청 한도를 초과했습니다.
```
→ 잠시 후 다시 시도하거나 OpenAI 플랜 업그레이드

### 응답 없음
```
Error: AI 응답을 받지 못했습니다.
```
→ 네트워크 연결 확인 및 OpenAI 서비스 상태 확인

## 개발자 참고

### API Route 수정 시:
- `app/api/ai/refine-meditation/route.ts` 파일 수정
- System prompt 튜닝으로 AI 응답 품질 개선
- Temperature 조절로 창의성/일관성 균형 조정

### UI 수정 시:
- `app/posts/new/page.tsx` 파일 수정
- 작성 모드 전환 로직
- AI 검수 버튼 및 상태 관리

### 테스트:
```bash
# 개발 서버 실행
npm run dev

# /posts/new 페이지에서 AI 가이더 모드 테스트
```

## 라이선스 및 크레딧

- OpenAI GPT-4o-mini 모델 사용
- OpenAI 이용 약관 준수 필요

